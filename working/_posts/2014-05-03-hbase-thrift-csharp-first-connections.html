---
layout: post
title: HBase, Thrift & C# - First Connections
date: '2014-05-03T00:21:00.001-07:00'
author: William Berry
tags:
- HBase
- C#
- Thrift
modified_time: '2014-05-17T23:39:48.739-07:00'
blogger_id: tag:blogger.com,1999:blog-4707687462195457004.post-5568222696367618036
blogger_orig_url: http://www.lucidmotions.net/2014/05/hbase-thrift-csharp-first-connections.html
---

I seemingly have a bad habit of never writing part two of a series. &nbsp;So to buck the trend, this piece is a follow up to&nbsp;<a href="http://www.lucidmotions.net/2014/04/nuget-code-generation-jenkins-thrift-hbase.html" target="_blank">NuGet Servers, HBase, Thrift Code Generation and one sweet Jenkins CI Build</a>. &nbsp;You don't need to read the whole post; but, familiarizing yourself with section III and on is important. &nbsp;Don't forget to check other posts in this series.<br /><br />Part 1 -&nbsp;<a class="GCUXF0KCPB" href="http://www.lucidmotions.net/2014/04/nuget-code-generation-jenkins-thrift-hbase.html" style="border: 0px; color: #1155cc; display: inline-block; font-family: Arial, Helvetica, sans-serif; font-size: 13px; margin: 0px 10px 0px 0px; max-width: 100%; overflow: hidden; padding: 0px; text-decoration: none; text-overflow: ellipsis; vertical-align: baseline; white-space: nowrap; width: auto;">NuGet Servers, HBase, Thrift Code Generation and one sweet Jenkins CI Build</a><br />Part 2 -&nbsp;<a class="GCUXF0KCPB" href="http://www.lucidmotions.net/2014/05/hbase-thrift-csharp-first-connections.html" style="border: 0px; color: #1155cc; display: inline-block; font-family: Arial, Helvetica, sans-serif; font-size: 13px; margin: 0px 10px 0px 0px; max-width: 100%; overflow: hidden; padding: 0px; text-decoration: none; text-overflow: ellipsis; vertical-align: baseline; white-space: nowrap; width: auto;">HBase, Thrift &amp; C# - First Connections</a><br />Part 3 -&nbsp;<a class="GCUXF0KCPB" href="http://www.lucidmotions.net/2014/05/hbase-thrift-csharp-session-management.html" style="border: 0px; color: #1155cc; display: inline-block; font-family: Arial, Helvetica, sans-serif; font-size: 13px; margin: 0px 10px 0px 0px; max-width: 100%; overflow: hidden; padding: 0px; text-decoration: none; text-overflow: ellipsis; vertical-align: baseline; white-space: nowrap; width: auto;">HBase, Thrift, &amp; C# - Managing Sessions</a><br />Part 4 -&nbsp;<a href="http://www.lucidmotions.net/2014/05/hbase-thrift-csharp-generic-row-scanner.html" style="border: 0px; color: #1155cc; display: inline-block; font-family: Arial, Helvetica, sans-serif; font-size: 13px; margin: 0px 10px 0px 0px; max-width: 100%; overflow: hidden; padding: 0px; text-decoration: none; text-overflow: ellipsis; vertical-align: baseline; white-space: nowrap; width: auto;" target="_blank">HBase, Thrift, &amp; C# - First Scanner and Leveraging Generics</a><br /><br /><div style="text-align: center;">***</div><br />Let's take a quick look at establishing connectivity to our HBase Thrift server. &nbsp;The example connection code in the thrift C# solution is a great primer and what we will use as the base here.<br /><br />For the majority of the code in the rest of this series, we will take a simplistic page from NHibernate's architecture. &nbsp;Let's start with a simple Interface called ISession which implements IDisposable. &nbsp;The implementation of IDisposable is so we can build sessions within a using statement, letting the framework do our heavy lifting.<br /><br />Further, we will build a class called Session that implements the Interface ISession. &nbsp;Its constructor will take a reference to our Pool Manager class and will take a Connection object that has configuration data in it.<br /><br /><div><pre><span style="color: teal;">  1</span> <span style="color: blue;">public</span> <span style="color: blue;">class</span> Session : ISession<br /><span style="color: teal;">  2</span> { <br /><span style="color: teal;">  3</span>     <span style="color: blue;">private</span> <span style="color: blue;">readonly</span> IConnection _connection;<br /><span style="color: teal;">  4</span>     <span style="color: blue;">private</span> <span style="color: blue;">readonly</span> ISessionPoolManager _manager;<br /><span style="color: teal;">  5</span>     <span style="color: blue;">private</span> <span style="color: blue;">readonly</span> TSocket _transport;<br /><span style="color: teal;">  6</span>     <span style="color: blue;">private</span> Hbase.Hbase.Client _client; <br /><span style="color: teal;">  7</span>  <br /><span style="color: teal;">  8</span>     <span style="color: blue;">public</span> Session(ISessionPoolManager manager, IConnection connection)<br /><span style="color: teal;">  9</span>     { <br /><span style="color: teal;"> 10</span>          Guid = Guid.NewGuid(); <br /><span style="color: teal;"> 11</span>          _connection = connection; <br /><span style="color: teal;"> 12</span>          _manager = manager; <br /><span style="color: teal;"> 13</span>          _transport = <span style="color: blue;">new</span> TSocket(Connection.Name, Connection.Port);<br /><span style="color: teal;"> 14</span>          var protocol = <span style="color: blue;">new</span> TBinaryProtocol(_transport);<br /><span style="color: teal;"> 15</span>          _client = <span style="color: blue;">new</span> Hbase.Hbase.Client(protocol);<br /><span style="color: teal;"> 16</span>     }</pre></div><br />The class has a private method called OpenConnection() that is used to, well, open a connection to HBase via Thrift. This code is very straight forward:<br /><br /><div><pre><span style="color: teal;">  1</span> <span style="color: blue;">private</span> Hbase.Hbase.Client OpenConnection()<br /><span style="color: teal;">  2</span> { <br /><span style="color: teal;">  3</span>      _transport.Open(); <br /><span style="color: teal;">  4</span>      IsConnected = _transport.IsOpen; <br /><span style="color: teal;">  5</span>      <span style="color: blue;">return</span> _client; <br /><span style="color: teal;">  6</span> }</pre></div><br />For completeness let's implement a CloseConnection():<br /><br /><div><pre><span style="color: teal;">  1</span> <span style="color: blue;">private</span> <span style="color: blue;">void</span> CloseConnection()<br /><span style="color: teal;">  2</span> { <br /><span style="color: teal;">  3</span>      &nbsp;_transport.Close(); </pre><pre><span style="color: teal;">  4</span>      &nbsp;IsConnected = _transport.IsOpen; </pre><pre><span style="color: teal;">  5</span> }</pre></div><br />Because the Session class implements the IDisposable interface we are required to have a Dispose method. &nbsp;The Dispose method calls our internal close on the transport and re-queues this object in Pool Manager's queue.<br /><br /><div><pre><span style="color: teal;">  1</span> <span style="color: blue;">public</span> <span style="color: blue;">void</span> Dispose()<br /><span style="color: teal;">  2</span> { <br /><span style="color: teal;">  3</span>      CloseConnection(); <br /><span style="color: teal;">  4</span>      _manager.Requeue(<span style="color: blue;">this</span>); <br /><span style="color: teal;">  5</span> }</pre></div><br />In the next article we will look at implementing a table scanner for HBase and the structure to support it.<br /><br /><div style="text-align: center;"><br /></div>