---
layout: post
title: 'Simple Disk Space Check on Scan w/ UpGuard '
date: '2015-10-22T13:47:00.002-07:00'
author: William Berry
tags:
- DevOps
- UpGuard
modified_time: '2016-01-28T09:42:27.487-08:00'
thumbnail: http://1.bp.blogspot.com/-TjeZaJCKtcI/VilHDFkbPvI/AAAAAAAAAbk/xuIHtdElh0o/s72-c/DiskSpace.png
blogger_id: tag:blogger.com,1999:blog-4707687462195457004.post-5748231254014322672
blogger_orig_url: http://www.lucidmotions.net/2015/10/simple-disk-space-check-w-UpGuard.html
---

<div class="separator" style="clear: both; text-align: center;"><a href="http://i.imgur.com/9VM9qDd.gif" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" src="http://i.imgur.com/9VM9qDd.gif" /></a></div>One of the few joys I have at work right now is that IT has given me carte blanche with respect to managing our engineering environment - they keep the power on and the network functioning. &nbsp;One of the few things I detest is that IT has given me carte blanche with respect to managing our engineering environment - the only thing they do is keep the power on and the network functioning. &nbsp;This un/fortunate position I find myself in means keeping the infrastructure for 8 devs and QA running smoothly, which is frankly no small feat. <br /><br />Given that I find my time rather precious, automating tasks is usually top of my list whenever infrastructure is involved. &nbsp;Lately our packaging server has been running out of space as the CI system has made it so painless to rebuild and repackage software. &nbsp;The task of cleaning out old builds and archiving *could* be automated except that we occasionally have long running projects that should not get auto-archived, and frankly manual review before archiving is not a horrible waste of time anyway. &nbsp;So rather than lean on the Task Scheduler to help me watch for disk space consumption, I've turned to my trusty installation of&nbsp;UpGuard&nbsp;for a helping hand.<br /><br /><script src="https://gist.github.com/WilliamBerryiii/6d91620b8a2ce54614f9.js"></script> The above Powershell simply checks the amount and percentage of free space available on all mounted drives that have a size value. &nbsp;It returns a bool since&nbsp;UpGuard&nbsp;does not currently allow actions on&nbsp;policy failure. &nbsp;Ideally you would configure this script as a policy and on policy failure it would email select parties the details of space allocation per drive and signal them to address it, or perhaps auto add comments to the created task; but for now, this is the best what we can do.<br /><br />Setting up the script to run on a group of nodes is quite simple:<br /><br /><ol><li>Create a new node group that represents all of the systems that should have this space scan applied.</li><li>Press the gear icon next to the node group to bring up the scan options.</li><li>Under 'Powershell Queries' create a new query.</li><li>Enter the name for the query, enter 'DeviceId' as the Key Name, paste the Powershell into the Query section and accept the change.</li><li>Scroll to the bottom of the scan option pane and press 'Save'.</li></ol><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-TjeZaJCKtcI/VilHDFkbPvI/AAAAAAAAAbk/xuIHtdElh0o/s1600/DiskSpace.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="322" src="http://1.bp.blogspot.com/-TjeZaJCKtcI/VilHDFkbPvI/AAAAAAAAAbk/xuIHtdElh0o/s640/DiskSpace.png" width="640" /></a></div><br />On the next scan of your environment,&nbsp;UpGuard&nbsp;will pickup the baseline for this value and on subsequent scans&nbsp;tasks will be created if the value changes. &nbsp;When/If policies come back with finer grained control, optional scan schedules or policy failure integrations, then moving this check from a scan option to a policy will be more helpful.<br /><br />Happy&nbsp;UpGuardin'