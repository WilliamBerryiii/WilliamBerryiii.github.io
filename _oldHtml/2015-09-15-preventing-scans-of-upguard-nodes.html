---
layout: post
title: Preventing Scans of UpGuard Nodes During Deployments w/Powershell v3.0+
date: '2015-09-15T23:31:00.001-07:00'
author: William Berry
tags:
- Automation
- APIs
- DevOps
- UpGuard
modified_time: '2016-01-28T09:49:42.480-08:00'
blogger_id: tag:blogger.com,1999:blog-4707687462195457004.post-6680207448700637856
blogger_orig_url: http://www.lucidmotions.net/2015/09/preventing-scans-of-upguard-nodes.html
---

As we move our&nbsp;UpGuard&nbsp;installation into production I have a few security issues to contend with. &nbsp;The most&nbsp;significant concern is preventing a&nbsp;UpGuard&nbsp;scan from pulling down unencrypted configuration data&nbsp;during a deployment. &nbsp;In theory if a scan were to be triggered while secure data was being migrated from an old web.config to a new config, the scan could pick up IT eyes only data making it available to non-IT analysts with accounts on the appliance. &nbsp;Currently the Scriptrock API does not support a "disable scans" toggle for a node, so lets go hacking!<br /><div style="text-align: center;"><div style="text-align: left;"><br /></div><div style="text-align: left;">In the script below we are going to leverage the fact that we do not currently have any Agent based nodes configured on the appliance, everything thus far is SSH or WinRM. &nbsp;So for the node being deployed to, the simple fix is to temporarily change the Medium Type to 'Agent' while the automation runs. &nbsp;The script below can be converted into a function that takes a lambda that represents the body of your deployment script, thereby effectively "wrapping" your deployment scripts with this toggle.</div><div style="text-align: left;"><br /></div><div style="text-align: left;"><br /></div><script src="https://gist.github.com/WilliamBerryiii/5bf63a2601341ac49b63.js"></script> <br /><div style="text-align: left;"><br /></div><div style="text-align: left;"><h4>UPDATE:&nbsp;</h4>Alan Sharp-Paul from&nbsp;UpGuard&nbsp;, sent me a tweet to let me know about a feature of the API that can perform a&nbsp;similar function as noted above, that being the <a href="https://support.scriptrock.com/hc/en-us/articles/204586534-Scheduled-Jobs">Scheduled Jobs</a> endpoint. &nbsp;Depending on how you have set up your environments set up this may work quite well for you. &nbsp;In our case, we have nodes in an environment that span functionality, so a deployment may not cut across all of them. &nbsp;Given that, I see it as advantageous to disable the node as noted above, record the deployment event and then restore the node, allowing the other machines in that environment to be scanned if we run over in to the scheduled job. &nbsp;One alternative could be to check if the job is running, if so kill it, run the deployment and update the next scheduled run time to be shortly in the future (expect a post on this in the near future). <br /><br />Happy Scripting!</div></div>